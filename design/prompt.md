# 重写 Velocity 模板引擎的解析器任务

我需要你帮我将 Velocity 模板引擎的解析部分从 Jison 迁移到 Chevrotain。这是一个分步骤的任务，请按照以下流程进行：

## 第一阶段：项目分析

1. 分析整个代码仓库，特别关注：

   - 当前的 Jison 词法和语法定义文件 (velocity.l, velocity.yy 文件)
   - 解析器如何与模板引擎的其他部分交互
   - 测试用例中涉及解析的部分
   - 现有的 AST 结构和节点类型

2. 完成分析后，创建一个详细的 Markdown 文档，包含：
   - 现有 Token 定义的完整列表
   - 语法规则的概述
   - 解析过程中涉及的状态机流程
   - Token 和解析阶段的关键逻辑和边界情况

## 第二阶段：设计迁移计划

基于分析结果，设计 Chevrotain 实现的详细计划，将任务分解为以下部分：

1. **Lexer 实现计划**

   - [ ] 设计 Chevrotain Lexer 模式和 token 定义
   - [ ] 状态转换逻辑规划
   - [ ] 特殊字符处理策略

2. **Parser 实现计划**

   - [ ] 基于 .yy 文件设计语法规则
   - [ ] AST 节点结构设计
   - [ ] 错误处理和恢复策略

3. **集成计划**
   - [ ] 与现有代码的接口设计
   - [ ] 性能优化考虑
   - [ ] 测试策略

在设计文档中，使用 Markdown 任务列表（`- [ ]`）标记每个需要完成的任务，便于后续追踪进度。

## 第三阶段：逐步实现

根据设计文档按照以下顺序实现：

1. **首先实现 Lexer**

   - 创建 Token 定义
   - 实现状态转换逻辑
   - 编写单元测试验证 Token 输出

2. **然后实现 Parser**

   - 实现语法规则
   - 构建 AST 生成逻辑
   - 编写单元测试验证 Parser 输出

3. **最后进行集成与优化**
   - 将新解析器集成到模板引擎中
   - 运行现有测试验证功能
   - 进行性能优化

记得在每个任务完成后，更新设计文档中相应的任务状态（`- [x]`）。

## 注意事项

1. 所有代码注释和文档必须使用英文，不使用中文
2. 避免为通过测试而编写特定的 hack 代码
3. 确保解析逻辑的实现基于功能需求，而非仅为满足测试用例
4. 在实现过程中保持与我的沟通，特别是当遇到难以理解的现有逻辑时

请首先开始分析阶段，然后创建详细的设计文档，只有在设计文档完成并经我确认后再开始编写代码。
